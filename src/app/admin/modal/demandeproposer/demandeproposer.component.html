@if(demande){
    <div class="titre" mat-dialog-title>
        <h2  >Détails de la demande </h2>
        <span style="color: gray; font-size: medium; margin-top: -20px; margin-left: 20px;">{{demande.titre}} </span>
    </div>
    <mat-dialog-content class="mat-typography">
        <div class="d-flex" style="min-height: 100%;">
            <div ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-pills flex-column" orientation="vertical">
                <ng-container ngbNavItem="top">
                    <!-- <button ngbNavLink>Profile dr formateur</button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="a"><h6>Nom de formateur:</h6><small>{{demande.formateur.firstname}} {{demande.formateur.lastname}}</small></div>
                            <div class="a"><h6>Date de naissance:</h6><small>{{demande.formateur.naissance|date: 'dd/MM/yyyy'}}</small></div>
                            <div class="a"><h6>Email:</h6><small>{{demande.formateur.email}} </small></div>
                            <div class="a"><h6>Numero telephone:</h6><small>{{demande.formateur.tel}}</small></div>
                            <div class="a"><h6>CIN:</h6><small>{{demande.formateur.cin}}</small></div>
                            <div class="a"><h6>Adresse:</h6><small>{{demande.formateur.adresse}}</small></div>
                            @if (demande.formateur.linkedin !='') {
                                <div class="a"><h6>Consultez le profil LinkedIn :</h6><a href={{demande.formateur.linkedin}}>lien profile linkedin </a></div>
                            }
                        </div>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="b"><h6>Competances:</h6><small>{{demande.formateur.competance || "aucune competance n'est disponible"}}</small></div>
                            <div class="b"><h6>Competances techniques:</h6><small>{{demande.formateur.comTech || "aucune competance technique n'est disponible"}}</small></div>
                            <div class="b"><h6>information supplementaires:</h6><small>{{demande.formateur.autre || "aucun détail supplémentaire n'est disponible" }} </small></div>
                            <div class="b">
                                <h6>Formations Académiques et Certifications:</h6>
                                <mat-list>
                                    @for (item of formation; track $index) {
                                    <mat-list-item>
                                      <span matListItemTitle>{{item.diplome}} </span>
                                      <span matListItemLine>{{item.specialite}}</span>
                                      <span matListItemLine>{{item.date}} <a style="margin-left: 60%; color: #aaa;" href="#">Consulter le preuve</a></span>
                                    </mat-list-item>
                                }
                                </mat-list>
                            </div>
                            <div class="b">
                                <h6>Expériences professionnelles:</h6>
                                <mat-list>
                                    @for (item of expr; track $index) {
                                    <mat-list-item>
                                      <span matListItemTitle>{{item.poste}} </span>
                                      <span matListItemLine>{{item.entreprise}} {{item.lieu}}</span>
                                      <span matListItemLine>{{item.debut}}-{{item.fin}}</span>
                                    </mat-list-item>
                                }
                                </mat-list>
                            </div>
                        </div>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="a"><h6>Consulter le cv:</h6><a href="#">Lien cv</a></div>
                            @if (demande.formateur.portfolio !='') {
                                <div class="a"><h6>Consultez le portfolio :</h6><a href={{demande.formateur.linkedin}}>lien portfolio </a></div>
                            }
                        </div>
                        
                    </ng-template>
                </ng-container>
                <ng-container ngbNavItem="details"> -->
                    <button ngbNavLink>Details de demande </button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            <div align="end">
                                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                                    <mat-icon>more_vert</mat-icon>
                                  </button>
                                  <mat-menu #menu="matMenu">
                                    <button (click)="ModifierDemande()" mat-menu-item>
                                      <!-- <mat-icon>dialpad</mat-icon> -->
                                      <span>Modifier</span>
                                    </button>
                                  </mat-menu>
                            </div>
                           
                              
                            <div class="a"><h6>Description:</h6><small>{{demande.description}}</small></div>
                            <div class="a"><h6>Theme:</h6><small>
                                <mat-chip-listbox>
                                     <mat-chip *ngFor="let tag of demande.theme">{{tag}}</mat-chip>
                                </mat-chip-listbox>
                            </small></div>
                            <div class="a"><h6>Nombre des jours:</h6><small>{{sessions.length}} </small></div>
                            <div class="a"><h6>Date depot:</h6><small>{{demande.date|date :'dd/MM/yyyy'}}</small></div>
                            @if (demande.doc !=null) {
                                <div class="a"><h6>Document supplementaire:</h6><small>{{demande.doc}}</small></div>
                           }
                            <div class="a"><h6>Code:</h6><small>{{demande.code}}</small></div>
                            <div class="a"><h6>session:</h6>
                                <div>
                                    @for (item of sessions; track $index) {
                                        <small>{{$index +1 }}- {{item.nom}} ({{ item.date | date: 'fullDate' }})</small><br>
                                    }
                                </div>
                               
                            </div>
                        </div>
                        <div style="margin-bottom: 30px; display: flex; flex-direction: column; gap: 10px; " >
                            <h3>Formateurs ayant soumis une demande pour cette formation</h3>
                            <div class="info">
                            @for(item of demande.formateurPropose;track $index){
                                <div class="info formateur" (click)="toggleDetails(item.id)">
                                    <div class="front">
                                        <div class="image">
                                            <img [src]="formateurImageUrls[item.id]" alt="{{item.firstname}} {{item.lastname}}" class="formateur-image">
                                        </div>
                                        <div>
                                            <strong>{{item.firstname}} {{item.lastname}}</strong><br>
                                            <small>{{item.poste}}</small>
                                        </div>
                                    </div>
                                   
                                    <div class="details" *ngIf="selectedFormateur === item.id">
                                        <div class="det" style="max-height: 35vh;overflow-y: auto;padding: 1rem;">
                                            <div align="end" style="cursor: pointer;" (click)="openCvInNewTab(item.id)"> <strong style="color: black; font-size: 13px;">Consulter cv</strong></div>
                                            <div class="a"><h6>Bio:</h6><small>{{item.bio}}</small></div>
                                            <div class="a"><h6>Date de naissance:</h6><small>{{item.naissance| date: 'dd/MM/yyyy'}}</small></div>
                                            <div class="a"><h6>Email:</h6><small>{{item.email}}</small></div>
                                            <div class="a"><h6>Numero:</h6><small>{{item.tel}}</small></div>
                                            <div class="a"><h6>CIN:</h6><small>{{item.cin}} </small></div>
                                            <div class="a"><h6>Adresse:</h6><small>{{item.adresse}}</small></div>
                                            @if (item.linkedin !='') {
                                                <div class="a"><h6>Consultez le profil LinkedIn :</h6><a href={{item.linkedin}}>lien profile linkedin </a></div>
                                            }
                                            <div class="a"><h6>competances technique:</h6><small>{{item.comTech}}</small></div>
                                            <div class="a"><h6>competances:</h6><small>{{item.competances}}</small></div>
                                            <div class="b"><h6>information supplementaires:</h6><small>{{item.autre || "aucun détail supplémentaire n'est disponible" }} </small></div>
                                            <div class="b">
                                                <h6>Formations Académiques et Certifications:</h6>
                                                <mat-list>
                                                    @for (form of item.formAcademique; track $index) {
                                                    <mat-list-item>
                                                      <span matListItemTitle>{{form.diplome}} </span>
                                                      <span matListItemLine>{{form.specialite}}</span>
                                                      <span matListItemLine>{{form.date}} <a style="margin-left: 60%; color: #aaa;" href="#">Consulter le preuve</a></span>
                                                    </mat-list-item>
                                                }
                                                </mat-list>
                                            </div>
                                            <div class="b">
                                                <h6>Expériences professionnelles:</h6>
                                                <mat-list>
                                                    @for (exp of item.experiencePro; track $index) {
                                                    <mat-list-item>
                                                      <span matListItemTitle>{{exp.poste}} </span>
                                                      <span matListItemLine>{{exp.entreprise}} {{exp.lieu}}</span>
                                                      <span matListItemLine>{{exp.debut}}-{{exp.fin}}</span>
                                                    </mat-list-item>
                                                }
                                                </mat-list>
                                            </div>
                                        </div>
                                       <div align="end" class="action">
                                        <button style="display: flex; align-items: center; justify-content: center;" (click)="openDialog(item)" mat-stroked-button mat-raised-button><i style="color: green; font-size: 6px;" class="fa-solid fa-circle"></i> Assigner ce formateur à cette formation</button>
                                       </div>
                                    </div>
                                    
                               </div>
                            }@empty{
                                <small>Aucun formateur n'a soumis de demande</small>
                            }
                            </div>
                           
                        </div>
                    </ng-template>
                </ng-container>
                <!-- <ng-container ngbNavItem="middle">
                    <button ngbNavLink>Gestion des Demandes</button>
                    <ng-template ngbNavContent>
                        
                        <div style="margin-bottom: 30px; display: flex; flex-direction: column; gap: 10px; " >
                            <h3>Formateurs ayant soumis une demande pour cette formation</h3>
                            <div class="info">
                            @for(item of demande.formateurPropose;track $index){
                                <div class="info formateur">
                                    <img [src]="getFormateurImageUrl(item.id)" alt="{{item.firstname}} {{item.lastname}}" class="formateur-image">
                                    <div>
                                        <strong>{{item.firstname}} {{item.lastname}}</strong><br>
                                        <small>{{item.poste}}</small>
                                    </div>
                                    <div class="details"></div>
                               </div>
                            }@empty{
                                <small>Aucun formateur n'a soumis de demande</small>
                            }
                            </div>
                           
                        </div>
                    </ng-template>
                </ng-container> -->
                <ng-container ngbNavItem="certif">
                    <button ngbNavLink>Certification</button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            @if (demande.certifications.length>0) {
                                <iframe [src]="fileContent" width="100%" height="370px"></iframe>
                            }@else {
                            <div class="mt-3">
                                <h3>Uploaded Files:</h3>
                                <ul class="list-group">
                                    <mat-radio-group  [(ngModel)]="certificateId">
                                        <li *ngFor="let certificate of certificat" class="list-group-item">
                                            <mat-radio-button class="example-radio-button" value={{certificate.id}}>{{ certificate.fileName }}</mat-radio-button>   
                                        </li>
                                 </mat-radio-group>
                                </ul>
                              </div>
                           <div align="end"><button (click)="confirmerModele()" mat-raised-button style="margin-top: 7px;">Confirmer le modèle</button></div> 
                            <h2> Télécharger le modèle de certificat que vous souhaitez utiliser</h2>
                            <input type="file" (change)="onFileSelected($event)"><br>
                            <button (click)="onUpload()" mat-raised-button style="margin-top: 7px;">Importer</button>
                            }
                        </div>
                    </ng-template>
                </ng-container>
            </div>
        
            <div [ngbNavOutlet]="nav" class="ms-4"></div>
        </div>
    </mat-dialog-content>
    
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Quitter</button>
    </mat-dialog-actions> 
}



