@if(demande){
    <div class="titre" mat-dialog-title>
        <h2  >Détails de la demande </h2>
        <span style="color: gray; font-size: medium; margin-top: -20px; margin-left: 20px;">{{demande.titre}} </span>
    </div>
    <mat-dialog-content class="mat-typography">
        <div class="d-flex" style="min-height: 100%;">
            <div ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-pills flex-column" orientation="vertical">
                <ng-container ngbNavItem="top">
                    <button ngbNavLink>Profile dr formateur</button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="a"><h6>Nom de formateur:</h6><small>{{demande.formateur.firstname}} {{demande.formateur.lastname}}</small></div>
                            <div class="a"><h6>Date de naissance:</h6><small>{{demande.formateur.naissance|date: 'dd/MM/yyyy'}}</small></div>
                            <div class="a"><h6>Email:</h6><small>{{demande.formateur.email}} </small></div>
                            <div class="a"><h6>Numero telephone:</h6><small>{{demande.formateur.tel}}</small></div>
                            <div class="a"><h6>CIN:</h6><small>{{demande.formateur.cin}}</small></div>
                            <div class="a"><h6>Adresse:</h6><small>{{demande.formateur.adresse}}</small></div>
                            @if (demande.formateur.linkedin !='') {
                                <div class="a"><h6>Consultez le profil LinkedIn :</h6><a href={{demande.formateur.linkedin}}>lien profile linkedin </a></div>
                            }
                        </div>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="b"><h6>Competances:</h6><small>{{demande.formateur.competance || "aucune competance n'est disponible"}}</small></div>
                            <div class="b"><h6>Competances techniques:</h6><small>{{demande.formateur.comTech || "aucune competance technique n'est disponible"}}</small></div>
                            <div class="b"><h6>information supplementaires:</h6><small>{{demande.formateur.autre || "aucun détail supplémentaire n'est disponible" }} </small></div>
                            <div class="b">
                                <h6>Formations Académiques et Certifications:</h6>
                                <mat-list>
                                    @for (item of formation; track $index) {
                                    <mat-list-item>
                                      <span matListItemTitle>{{item.diplome}} </span>
                                      <span matListItemLine>{{item.specialite}}</span>
                                      <span matListItemLine>{{item.date}} <a style="margin-left: 60%; color: #aaa;" href="#">Consulter le preuve</a></span>
                                    </mat-list-item>
                                }
                                </mat-list>
                            </div>
                            <div class="b">
                                <h6>Expériences professionnelles:</h6>
                                <mat-list>
                                    @for (item of expr; track $index) {
                                    <mat-list-item>
                                      <span matListItemTitle>{{item.poste}} </span>
                                      <span matListItemLine>{{item.entreprise}} {{item.lieu}}</span>
                                      <span matListItemLine>{{item.debut}}-{{item.fin}}</span>
                                    </mat-list-item>
                                }
                                </mat-list>
                            </div>
                        </div>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="a"><h6>Consulter le cv:</h6><a style="cursor: pointer;" (click)="openCvInNewTab()">Lien cv</a></div>
                            @if (demande.formateur.portfolio !='') {
                                <div class="a"><h6>Consultez le portfolio :</h6><a href={{demande.formateur.linkedin}}>lien portfolio </a></div>
                            }
                        </div>
                        
                    </ng-template>
                </ng-container>
                <ng-container ngbNavItem="details">
                    <button ngbNavLink>Details de demande </button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            <div class="a"><h6>Description:</h6><small>{{demande.description}}</small></div>
                            <div class="a"><h6>Theme:</h6><small>{{demande.theme}}</small></div>
                            <div class="a"><h6>Nombre des jours:</h6><small>{{demande.nbrSession}} </small></div>
                            <div class="a"><h6>Date depot:</h6><small>{{demande.date|date :'dd/MM/yyyy'}}</small></div>
                            @if (demande.doc !=null) {
                                <div class="a"><h6>Document supplementaire:</h6><small>{{demande.doc}}</small></div>
                           }
                           @if (demande.status=='accept') {
                            <div class="a"><h6>Code:</h6><small>{{demande.code}}</small></div>
                        }
                        </div>
                    </ng-template>
                </ng-container>
                <ng-container ngbNavItem="middle">
                    <button ngbNavLink>Gestion des Demandes</button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            @if (demande.status=='traitement') {
                                <div class="res">
                                    <div class="custom-control custom-radio custom-control-inline">
                                        <input type="radio" [(ngModel)]="status"  id="customRadioInline1"  class="custom-control-input" value="accept">
                                        <label class="custom-control-label" for="customRadioInline1">Approuver la demande</label>
                                      </div>
                                      <div class="custom-control custom-radio custom-control-inline">
                                        <input type="radio" [(ngModel)]="status"  id="customRadioInline2"  class="custom-control-input" value="refus">
                                        <label class="custom-control-label" for="customRadioInline2">Rejeter la demande</label>
                                      </div>
                                </div>
                                @if (status=='refus') {
                                <form  [formGroup]="gestionForm" (ngSubmit)="refus()" >
                                    <div style="margin-top: 40px; width: 100%;" class="info">
                                        <h3 style="margin-left: 10px; margin-bottom: -2px;">raison</h3>
                                        <mat-form-field class="example-full-width" style="width: 100%;">
                                            <mat-label>Veuillez indiquer les raisons du refus de la demande </mat-label>
                                            <textarea matInput formControlName="raison" placeholder="les raisons ..."></textarea>
                                          </mat-form-field>
                                          <div align="end"><button type="submit"  mat-stroked-button>Confirmer la réponse</button></div>
                                    </div> 
                                </form>
                                }@else if (status=='accept') {
                                    <div class="info" style="margin-top: 50px;">
                                    <!-- <form [formGroup]="acceptForm" (ngSubmit)="accept()" *ngIf="!showAgendaa">
                                        <mat-form-field class="example-form-field" style="width: 100%; ">
                                            <mat-label>Produire le code des sessions</mat-label>
                                            <input matInput formControlName="code" type="text" [(ngModel)]="value">
                                            @if (value) {
                                              <button matSuffix mat-icon-button aria-label="Clear" (click)="value=''">
                                                <mat-icon>close</mat-icon>
                                              </button>
                                            }
                                        </mat-form-field>
                                        <div align="end" style=" padding: 1rem;"><button type="submit"   mat-stroked-button>Confirmer la réponse</button></div>
                                    </form> -->
                                    <div class="info">
                                        Code de la session: <span style="font-weight: 600; margin-left: 25px;">{{demande.code}}</span>
                                    </div>
                                    <div align="end" style=" padding: 1rem;"><button (click)="accept()"   mat-stroked-button>Approuver la demande</button></div>
                                    @if (showAgendaa) {
                                    <div class="agendaa" >
                                        <p style="margin-top: 50px;">Sélectionner la date de votre session.</p>
                                        <div style="display: flex; align-items: center; justify-content: center;">
                                             <div class="agenda"><app-agenda [agendaData]=demande.id></app-agenda></div>
                                         </div>
                                    </div>
                                    }
                                </div>

                                    <!-- <div class="info" style="margin-top: 50px;">
                                        <form [formGroup]="acceptForm" (ngSubmit)="accept()">
                                        <mat-form-field class="example-form-field" style="width: 100%; ">
                                            <mat-label>Produire le code des sessions</mat-label>
                                            <input matInput formControlName="code" type="text" [(ngModel)]="value">
                                            @if (value) {
                                              <button matSuffix mat-icon-button aria-label="Clear" (click)="value=''">
                                                <mat-icon>close</mat-icon>
                                              </button>
                                            }
                                        </mat-form-field>
                                        <div align="end" style=" padding: 1rem;"><button type="submit"   mat-stroked-button>Confirmer la réponse</button></div>
                                    </form>
                                        <mat-accordion>
                                        @for (item of nbreSession(demande.nbrSession); track $index) {     
                                                <mat-expansion-panel hideToggle>
                                                  <mat-expansion-panel-header>
                                                    <mat-panel-title>
                                                      session {{$index+1}}
                                                    </mat-panel-title> -->
                                                    <!-- <mat-panel-description>
                                                      This is a summary of the content
                                                    </mat-panel-description> -->
                                                  <!-- </mat-expansion-panel-header>
                                                 <form [formGroup]="sessionForm" (submit)="addSession()">
                                                    <div align="center" style="margin-top: 10px; width: 100%;">
                                                        <mat-form-field class="example-full-width">
                                                            <mat-label>Title</mat-label>
                                                            <input matInput formControlName="nom" placeholder="Ex. Tunis" value="{{demande.titre}} S{{$index+1}}">
                                                          </mat-form-field>
                                                    </div>
                                                    <div align="center" style="margin-top: 10px; width: 100%;">
                                                        <mat-form-field class="example-full-width">
                                                            <mat-label>Lieu</mat-label>
                                                            <input matInput formControlName="lieu" placeholder="Ex. Tunis">
                                                          </mat-form-field>
                                                    </div>
                                                    <div align="center" style="margin-bottom: 10px; width: 100%; ">
                                                        <mat-form-field class="example-full-width" >
                                                            <mat-label> Date pour la session</mat-label>
                                                                <input matInput formControlName="date" [matDatepicker]="picker">
                                                                <mat-hint>mm/jj/aaaa</mat-hint>
                                                                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                                                                <mat-datepicker #picker [calendarHeaderComponent]="exampleHeader"></mat-datepicker>
                                                            </mat-form-field>
                                                    </div>
                                                    
                                                    <div class="time">
                                                        De  <ngb-timepicker formControlName="debut" [spinners]="false" /> a <ngb-timepicker formControlName="fin" [spinners]="false" />
                                                    </div>
                                                    <div align="end" style="margin-top: 15px; padding: 1rem;"><button type="submit"  mat-stroked-button>Confirmer</button></div>
                                                 </form>
                                                </mat-expansion-panel>
                                        }
                                    </mat-accordion>
                                  
    
    
                                    </div> -->
                                    
                                
                               
                                }
                               
                            }
                        </div>
                    </ng-template>
                </ng-container>
                <ng-container ngbNavItem="certif">
                    <button ngbNavLink>Certification</button>
                    <ng-template ngbNavContent>
                        <div style="margin-bottom: 30px;" class="info">
                            @if (demande.certifications.length>0) {
                                <iframe [src]="fileContent" width="100%" height="370px"></iframe>
                            }@else {
                            <div class="mt-3">
                                <h3>Uploaded Files:</h3>
                                <ul class="list-group">
                                    <mat-radio-group  [(ngModel)]="certificateId">
                                        <li *ngFor="let certificate of certificat" class="list-group-item">
                                            <mat-radio-button class="example-radio-button" value={{certificate.id}}>{{ certificate.fileName }}</mat-radio-button>   
                                        </li>
                                 </mat-radio-group>
                                </ul>
                              </div>
                           <div align="end"><button (click)="confirmerModele()" mat-raised-button style="margin-top: 7px;">Confirmer le modèle</button></div> 
                            <h2> Télécharger le modèle de certificat que vous souhaitez utiliser</h2>
                            <input type="file" (change)="onFileSelected($event)"><br>
                            <button (click)="onUpload()" mat-raised-button style="margin-top: 7px;">Importer</button>
                           
                            }
                        </div>
                    </ng-template>
                </ng-container>
                <ng-container ngbNavItem="bottom">
                    @if (demande.status=='accept') {
                        
                    <button ngbNavLink>Liste des apprenants inscrits</button>
                    <ng-template ngbNavContent>
                        
                        Liste des sessions
                                <div style="margin-top: 30px;" class="info">
                                    <table class="table table-hover">
                                        <tbody>
                                            @for (item of demande.apprenants; track $index) {
                                          <tr>
                                            <td (click)="openApprenant(item)">{{item.firstname}} {{item.lastname}}</td>
                                          </tr>
                                        }
                                        </tbody>
                                      </table>
                                    <!-- <mat-list role="list">
                                        <mat-list-item (click)="openApprenant()" role="listitem"> nom</mat-list-item>
                                </mat-list> -->
                                </div>
                        
                    </ng-template>
                }@else {
                    <button disabled class="btnl" style="border-color: transparent; color: #bbb; font-size: 14px; padding: 1rem auto; ">Liste des apprenants inscrits</button>
                }
                </ng-container>
            </div>
        
            <div [ngbNavOutlet]="nav" class="ms-4"></div>
        </div>
    </mat-dialog-content>
    
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Quitter</button>
    </mat-dialog-actions> 
    <!-- <div style="padding: 0 15px;">
    </div>
    <mat-dialog-content class="mat-typography">
    <div style="margin-bottom: 30px;" class="info">
        <div class="a"><h6>Formateur:</h6><small>{{session.demande.formateur.firstname}} {{session.demande.formateur.lastname}}</small></div>
        <div class="a"><h6>Theme de session:</h6><small>{{session.demande.theme}}</small></div>
        <div class="a"><h6>Num de sessions:</h6><small>1</small></div>
        <div class="a"><h6>Date:</h6><small>{{session.date|date:'dd/MM/yyyy'}} de {{session.debut|date:'HH:mm'}} a {{session.fin|date:'HH:mm'}}</small></div>
        <div class="a"><h6>Lieu:</h6><small>{{session.lieu}}</small></div>
    </div>
    <mat-accordion >
        <mat-expansion-panel (opened)="panelOpenState = true"
                             (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title>
                Présence
            </mat-panel-title>
          </mat-expansion-panel-header>
          <button style="margin-top: 20px;" mat-stroked-button (click)="openSnackBar()">
            Marquer Présent
          </button>
        </mat-expansion-panel>

        <mat-expansion-panel (opened)="panelOpenState = true"
                             (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title>
                Evaluation
            </mat-panel-title>
            
          </mat-expansion-panel-header>
          <button style="margin-top: 20px;" mat-stroked-button (click)="evaluer(session.id)">
            Évaluer la Session
        </button>
        </mat-expansion-panel>

        <mat-expansion-panel (opened)="panelOpenState = true"
                             (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title>
                Ajout Cours
            </mat-panel-title>
            <mat-panel-description>
              
            </mat-panel-description>
          </mat-expansion-panel-header>
         
        </mat-expansion-panel>
      </mat-accordion>
      
    </mat-dialog-content>
    <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Annuler</button>
    
    </mat-dialog-actions> -->
}



